sap.ui.define(["sap/ui/core/mvc/Controller",
	"sap/ui/model/json/JSONModel",
	"sap/m/MessageBox",
	"sap/m/Token"
], function (Controller, JSONModel, MessageBox, Token) {
	"use strict";
	return Controller.extend("zpurch_mgmt_app.ZPURCH_MGMT_APP.controller.Search", {
		onInit: function () {
			var oThis = this;
			var oComponent = oThis.getOwnerComponent();
			oThis._oResourceBundle = oComponent.getModel("i18n").getResourceBundle();
			oThis.oRouter = sap.ui.core.UIComponent.getRouterFor(oThis);

			// sap.ui.getCore().setModel(oF4Model, "F4Model");

			// To add token on PO Number Input
			var oMultiInput = oThis.getView().byId("PO");
			//******* MultiInput - add asynchronous validator
			oMultiInput.addValidator(function (args) {
				var oToken = new Token({
					key: args.text,
					text: args.text
				});
				args.asyncCallback(oToken);
			});

		},

		handleDataChange: function (oEvent) {
			// Validate PO Number field token length
			var oThis = this;
			var oView = oThis.getView();
			var msgTextError2 = oThis._oResourceBundle.getText("MaxTokenlimit");
			var bCompact = !!this.getView().$().closest(".sapUiSizeCompact").length;
			if (oView.byId("PO").getTokens().length > oView.byId("PO").getMaxTokens()) {
				MessageBox.error(
					msgTextError2, {
						styleClass: bCompact ? "sapUiSizeCompact" : ""
					}
				);

				oView.byId("PO").removeAllTokens();
				// Highligting the Material filed if its empty
				oThis.getView().byId("PO").focus();
				oThis.getView().byId("PO").setValueState("Error");
				oThis.getView().byId("PO").setValueStateText("Max 5 inputs allowed");

			} else {
				oThis.getView().byId("PO").focus();
				oThis.getView().byId("PO").setValueState("None");
				oThis.getView().byId("PO").setValueStateText("None");
				// Do Nothing
			}
		},
		/**
		 *@memberOf zpurch_mgmt_app.ZPURCH_MGMT_APP.controller.Search
		 */
		navBackFLP: function (oEvent) {
			//This code was generated by the layout editor.
			var oCrossAppNavigator = sap.ushell.Container.getService("CrossApplicationNavigation");
			// Navigate back to FLP home
			oCrossAppNavigator.toExternal({
				target: {
					shellHash: "#Shell-home"
				}
			});
		},

		onPOValueHelpRequest: function (oEvent) {

			if (!this._dialog) {
				this._dialog = sap.ui.xmlfragment(this.getView().getId(), "zpurch_mgmt_app.ZPURCH_MGMT_APP.view.fragments.POValueHelp", this);
				this.getView().addDependent(this._dialog);

			}
			// open dialog
			jQuery.sap.syncStyleClass("sapUiSizeCompact", this.getView(), this._dialog);
			this._dialog.open();
		},

		onSearchPO: function (oEvent) {
			var oThis = this;
			var oView = oThis.getView();
			var outPutTable = this.getView().byId("ValuehelpTabPO");
			var inpPO = oView.byId("idShPOno").getValue();
			var inpPODate = oView.byId("idShCrtDt").getValue();
			var inpPOType = oView.byId("idShPOType").getValue();

			// Call Odata model
			var oPOModel = oThis.getOwnerComponent().getModel("POModel");
			var POShOutput = new JSONModel();

			oPOModel.read("/POSearchSet", {
				urlParameters: {
					"$filter": "Ebeln eq '" + inpPO + "' and Bsart eq '" + inpPOType + "' and Aedat eq '" + inpPODate + "'"
				},
				success: function (oData, response) {
					oThis.getView().byId("ValuehelpTabPO").setVisible(true);
					// oThis.getView().byId("searchbtn2").setVisible(false);
					// oThis.getView().byId("idsearchBarF4").setVisible(true);
					oThis.getView().byId("okbtn2").setVisible(true);
					POShOutput.setData(oData);
					// masterOutput.setSizeLimit(oData.results[0].ValueHelpOutSet.results.length);
					outPutTable.setModel(POShOutput, "POShOutput");
					if (oData.results[0].ValueHelpOutSet.results.length) {
						var iTotalItems = oData.results[0].ValueHelpOutSet.results.length;
						oThis.byId("idSearchResultTxt").setText(oThis._oResourceBundle.getText("SearchResultCount", [iTotalItems]));
					}

				},
				error: function (oError) {
					oThis.oErrorwrap(oError);
				}
			});

		},

		onCancelPO: function (oEvent) {
			// this.getView().byId("F4PODialog").close();
			this._dialog.close()
			this._dialog.destroy()
				// this.getView().byId("F4PODialog").destroy();
		},

		handleSearch: function (oEvent) {

		},

		handleConfirm: function (oEvent) {

		},
		/**
		 *@memberOf zpurch_mgmt_app.ZPURCH_MGMT_APP.controller.Search
		 */
		onSearch: function (oEvent) {
			//This code was generated by the layout editor.
		},
		/**
		 *@memberOf zpurch_mgmt_app.ZPURCH_MGMT_APP.controller.Search
		 */
		onNavDetail: function (oEvent) {
			//This code was generated by the layout editor.
		}
	});
});